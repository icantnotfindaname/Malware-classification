import os
import time
from turtle import st
import pandas as pd
import numpy as np
import constants
from form_process import get_csv_path, load_csv_to_dict


def is_folder_exists(dir):
    return os.path.exists(dir)


def create_folder(dir):
    os.makedirs(dir)


def get_time_string():
    time_struct = time.localtime(time.time())
    time_string = time.asctime(time_struct)
    time_string_without_space_and_colon = time_string.replace(':', '').replace(
        ' ', '')
    return time_string_without_space_and_colon


def save_img(img, ist, id):
    if not is_folder_exists(ist.dir):
        create_folder(ist.dir)
    img_save_path = generate_img_path(ist, id)
    img.save(img_save_path)


def save_img_by_family(img, ist, id, serial_num):
    if not is_folder_exists(ist.dir):
        create_folder(ist.dir)
    img_save_path = generate_img_path_by_family(ist, id, serial_num)
    img.save(img_save_path)


def load_file(path):
    file = open(path, 'rb')
    return file


def generate_file_path(dst, id):
    return os.path.join(dst.dir, id + dst.suffix).replace("\\", "/")


def get_file_length(path):
    return os.path.getsize(path)


def generate_img_path(ist, id):
    return os.path.join(ist.dir,
                        id + '_' + ist.title + ist.suffix).replace("\\", "/")


def generate_img_path_for_subset_by_family(ist, serial_num, id):
    save_dir = generate_img_dir_for_subset_by_family(ist, serial_num)
    save_path = os.path.join(save_dir, id + ist.suffix).replace("\\", "/")
    return save_path


def generate_img_path_for_subset_by_dir(ist, save_dir, id):
    save_path = os.path.join(save_dir, id + ist.suffix).replace("\\", "/")
    return save_path


def generate_img_dir_for_subset_by_family(ist, serial_num):
    save_dir = os.path.join(ist.dir, str(serial_num)).replace("\\", "/")
    if not is_folder_exists(save_dir):
        create_folder(save_dir)
    return save_dir


def generate_img_path_by_family(ist, serial_num, id):
    return os.path.join(
        ist.dir,
        ist.title + '_' + str(serial_num) + '_' + id + ist.suffix).replace(
            "\\", "/")


def get_array_from_feather(feather_file_path):
    df = pd.read_feather(feather_file_path)
    return df.to_numpy()


def get_id_by_processed_img_name(str):
    return str[:-14]


def get_label_by_id_from_dict(id, dict):
    return dict[id]


# if __name__ == '__main__':
#     get_array_from_feather('./testres/test.feather')

#     id = '0A32eTdBKayjCWhZqDOQ_processed.png'
#     id = get_id_by_processed_img_name(id)
#     print(get_id_by_processed_img_name(id))
#     csv_path = get_csv_path(constants.lt)
#     dict = load_csv_to_dict(csv_path)
#     print(dict)
#     label = get_label_by_id_from_dict(id, dict)
#     print(type(label))